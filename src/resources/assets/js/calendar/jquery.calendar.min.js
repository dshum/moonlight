!function(e){var t=function(){this.date=new Date};t.VERSION="1.2",t.TODAY="Сегодня",t.DAY_NAMES=new Array("Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"),t.SHORT_DAY_NAMES=new Array("Вс","Пн","Вт","Ср","Чт","Пт","Сб"),t.MONTH_NAMES=new Array("Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"),t.MONTH_NAMES_IN_GENITIVE_CASE=new Array("января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"),t.SHORT_MONTH_NAMES=new Array("Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"),t.NAV_PREVIOUS_YEAR=-2,t.NAV_PREVIOUS_MONTH=-1,t.NAV_TODAY=0,t.NAV_NEXT_MONTH=1,t.NAV_NEXT_YEAR=2,t._checkCalendar=function(t){return!!window._popupCalendar&&(!(e(t.target).parents().index(e(window._popupCalendar.container))>=0)&&(window._popupCalendar.callCloseHandler(),t.preventDefault()))},t.handleMouseDownEvent=function(a){e(document).mouseup(t.handleMouseUpEvent),a.preventDefault()},t.handleMouseUpEvent=function(a){var n=a.target,s=n.calendar,r=!1;if(!s)return!1;if(void 0===n.navAction){s.currentDateElement&&(s.currentDateElement.removeClass("selected"),e(n).addClass("selected"),s.shouldClose=s.currentDateElement==e(n),s.shouldClose||(s.currentDateElement=e(n))),s.date.setDateOnly(n.date),r=!0,s.shouldClose=!e(n).hasClass("otherDay"),!s.shouldClose&&s.update(s.date)}else{var l=new Date(s.date);n.navAction==t.NAV_TODAY&&l.setDateOnly(new Date);var o=l.getFullYear(),i=l.getMonth();function d(e){var t=l.getDate(),a=l.getMonthDays(e);t>a&&l.setDate(a),l.setMonth(e)}switch(n.navAction){case t.NAV_PREVIOUS_YEAR:o>s.minYear&&l.setFullYear(o-1);break;case t.NAV_PREVIOUS_MONTH:i>0?d(i-1):o-- >s.minYear&&(l.setFullYear(o),d(11));break;case t.NAV_TODAY:break;case t.NAV_NEXT_MONTH:i<11?d(i+1):o<s.maxYear&&(l.setFullYear(o+1),d(0));break;case t.NAV_NEXT_YEAR:o<s.maxYear&&l.setFullYear(o+1)}l.equalsTo(s.date)?0==n.navAction&&(r=s.shouldClose=!0):(s.shouldClose=!1,s.setDate(l),r=!0)}return r&&a&&s.callSelectHandler(),s.shouldClose&&a&&s.callCloseHandler(),e(document).unbind("mouseup",t.handleMouseUpEvent),a.preventDefault()},t.defaultShowHandler=function(e){return!!e.dateField},t.defaultSelectHandler=function(e){return!!e.dateField&&("INPUT"==e.dateField.get(0).tagName?e.dateField.val(e.date.print(e.dateFormat)):e.dateField.html(e.date.print(e.dateFormat)),e.dateField.trigger("change"),e.shouldClose&&e.callCloseHandler(),!0)},t.defaultCloseHandler=function(e){e.hide()},t.prototype={container:null,date:null,currentDateElement:null,shouldClose:!1,isPopup:!0,update:function(a){var n=this,s=new Date,r=s.getFullYear(),l=s.getMonth(),o=s.getDate(),i=a.getMonth(),d=a.getDate();a.getFullYear()<this.minYear?a.setFullYear(this.minYear):a.getFullYear()>this.maxYear&&a.setFullYear(this.maxYear),this.date=new Date(a),a.setDate(1);var h=(a.getDay()-this.firstDayOfWeek)%7;h<0&&(h+=7),a.setDate(-h),a.setDate(a.getDate()+1),e("tbody tr",this.container).each(function(){var t=!1;e(this).children().each(function(){var s=a.getDate(),h=a.getDay(),u=a.getMonth()==i;cell=e(this),cell.removeAttr("class"),cell[0].date=new Date(a),cell.html(s),u?t=!0:cell.addClass("otherDay"),u&&s==d&&(cell.addClass("selected"),n.currentDateElement=cell),a.getFullYear()==r&&a.getMonth()==l&&s==o&&cell.addClass("today"),-1!=n.weekend.indexOf(h.toString())&&cell.addClass("weekend"),a.setDate(s+1)}),t?e(this).show():e(this).hide()}),e("td.title",this.container).html(t.MONTH_NAMES[i]+" "+n.date.getFullYear())},create:function(a){this.isPopup=!1,a||(a=e("body"),this.isPopup=!0);var n=e("<table />"),s=e("<thead />");n.append(s);var r=e("<tr />"),l=e('<td colspan="7" class="title" />');r.append(l),s.append(r),r=e("<tr />"),this._drawButtonCell(r,"&#x00ab;",1,t.NAV_PREVIOUS_YEAR),this._drawButtonCell(r,"&#x2039;",1,t.NAV_PREVIOUS_MONTH),this._drawButtonCell(r,t.TODAY,3,t.NAV_TODAY),this._drawButtonCell(r,"&#x203a;",1,t.NAV_NEXT_MONTH),this._drawButtonCell(r,"&#x00bb;",1,t.NAV_NEXT_YEAR),s.append(r),r=e("<tr />");for(var o=0;o<7;++o){var i=(o+this.firstDayOfWeek)%7;l=e("<th />").html(t.SHORT_DAY_NAMES[i]),-1!=this.weekend.indexOf(i.toString())&&l.addClass("weekend"),r.append(l)}s.append(r);var d=n.append(e("<tbody />"));for(o=6;o>0;--o){r=e("<tr />").addClass("days"),d.append(r);for(var h=7;h>0;--h)(l=e("<td />"))[0].calendar=this,r.append(l)}this.container=e("<div />").addClass("calendar").append(n),this.isPopup&&this.container.css({position:"absolute",display:"none"}).addClass("popup"),this.update(this.date),this.container.mousedown(t.handleMouseDownEvent),a.append(this.container)},_drawButtonCell:function(t,a,n,s){var r=e("<td />");return n>1&&(r[0].colSpan=n),r.addClass("button").html(a).attr("unselectable","on"),r[0].calendar=this,r[0].navAction=s,t.append(r),r},callShowHandler:function(){this.showHandler&&this.showHandler(this,this.date.print(this.dateFormat))},callSelectHandler:function(){this.selectHandler&&this.selectHandler(this,this.date.print(this.dateFormat))},callCloseHandler:function(){this.closeHandler&&this.closeHandler(this)},show:function(){this.callShowHandler(),this.container.show(),this.isPopup&&(window._popupCalendar=this,e(document).mousedown(t._checkCalendar))},showAt:function(e,t){this.container.css({left:e+"px",top:t+"px"}),this.show()},showAtElement:function(e){var t=e.offset();this.showAt(t.left,t.top)},hide:function(){this.isPopup&&e(document).unbind("mousedown",t._checkCalendar),this.container.hide()},parseDate:function(e,t){t||(t=this.dateFormat),this.setDate(Date.parseDate(e,t))},setDate:function(e){e.equalsTo(this.date)||this.update(e)},setRange:function(e,t){this.minYear=e,this.maxYear=t}},window._popupCalendar=null,Date.DAYS_IN_MONTH=new Array(31,28,31,30,31,30,31,31,30,31,30,31),Date.SECOND=1e3,Date.MINUTE=60*Date.SECOND,Date.HOUR=60*Date.MINUTE,Date.DAY=24*Date.HOUR,Date.WEEK=7*Date.DAY,Date.parseDate=function(e,a){var n=new Date,s=0,r=-1,l=0,o=e.split(/\W+/),i=a.match(/%./g),d=0,h=0,u=0,c=0;for(d=0;d<o.length;++d)if(o[d])switch(i[d]){case"%d":case"%e":l=parseInt(o[d],10);break;case"%m":r=parseInt(o[d],10)-1;break;case"%Y":case"%y":(s=parseInt(o[d],10))<100&&(s+=s>29?1900:2e3);break;case"%b":case"%B":for(h=0;h<12;++h)if(t.MONTH_NAMES[h].substr(0,o[d].length).toLowerCase()==o[d].toLowerCase()){r=h;break}break;case"%H":case"%I":case"%k":case"%l":u=parseInt(o[d],10);break;case"%P":case"%p":/pm/i.test(o[d])&&u<12?u+=12:/am/i.test(o[d])&&u>=12&&(u-=12);break;case"%M":c=parseInt(o[d],10)}if(isNaN(s)&&(s=n.getFullYear()),isNaN(r)&&(r=n.getMonth()),isNaN(l)&&(l=n.getDate()),isNaN(u)&&(u=n.getHours()),isNaN(c)&&(c=n.getMinutes()),0!=s&&-1!=r&&0!=l)return new Date(s,r,l,u,c,0);for(s=0,r=-1,l=0,d=0;d<o.length;++d)if(-1!=o[d].search(/[a-zA-Z]+/)){var p=-1;for(h=0;h<12;++h)if(t.MONTH_NAMES[h].substr(0,o[d].length).toLowerCase()==o[d].toLowerCase()){p=h;break}-1!=p&&(-1!=r&&(l=r+1),r=p)}else parseInt(o[d],10)<=12&&-1==r?r=o[d]-1:parseInt(o[d],10)>31&&0==s?(s=parseInt(o[d],10))<100&&(s+=s>29?1900:2e3):0==l&&(l=o[d]);return 0==s&&(s=n.getFullYear()),-1!=r&&0!=l?new Date(s,r,l,u,c,0):n},Date.prototype.getMonthDays=function(e){var t=this.getFullYear();return void 0===e&&(e=this.getMonth()),0!=t%4||0==t%100&&0!=t%400||1!=e?Date.DAYS_IN_MONTH[e]:29},Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0)-new Date(this.getFullYear(),0,0,0,0,0);return Math.floor(e/Date.DAY)},Date.prototype.getWeekNumber=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),t=e.getDay();e.setDate(e.getDate()-(t+6)%7+3);var a=e.valueOf();return e.setMonth(0),e.setDate(4),Math.round((a-e.valueOf())/6048e5)+1},Date.prototype.equalsTo=function(e){return this.getFullYear()==e.getFullYear()&&this.getMonth()==e.getMonth()&&this.getDate()==e.getDate()&&this.getHours()==e.getHours()&&this.getMinutes()==e.getMinutes()},Date.prototype.setDateOnly=function(e){var t=new Date(e);this.setDate(1),this.setFullYear(t.getFullYear()),this.setMonth(t.getMonth()),this.setDate(t.getDate())},Date.prototype.print=function(e){var a=this.getMonth(),n=this.getDate(),s=this.getFullYear(),r=this.getWeekNumber(),l=this.getDay(),o={},i=this.getHours(),d=i>=12,h=d?i-12:i,u=this.getDayOfYear();0==h&&(h=12);var c=this.getMinutes(),p=this.getSeconds();o["%a"]=t.SHORT_DAY_NAMES[l],o["%A"]=t.DAY_NAMES[l],o["%b"]=t.SHORT_MONTH_NAMES[a],o["%B"]=t.MONTH_NAMES[a],o["%G"]=t.MONTH_NAMES_IN_GENITIVE_CASE[a],o["%C"]=1+Math.floor(s/100),o["%d"]=n<10?"0"+n:n,o["%e"]=n,o["%H"]=i<10?"0"+i:i,o["%I"]=h<10?"0"+h:h,o["%j"]=u<100?u<10?"00"+u:"0"+u:u,o["%k"]=i,o["%l"]=h,o["%m"]=a<9?"0"+(1+a):1+a,o["%M"]=c<10?"0"+c:c,o["%n"]="\n",o["%p"]=d?"PM":"AM",o["%P"]=d?"pm":"am",o["%s"]=Math.floor(this.getTime()/1e3),o["%S"]=p<10?"0"+p:p,o["%t"]="\t",o["%U"]=o["%W"]=o["%V"]=r<10?"0"+r:r,o["%u"]=l+1,o["%w"]=l,o["%y"]=(""+s).substr(2,2),o["%Y"]=s,o["%%"]="%";for(var D=/%./g,g=e.match(D),f=0;f<g.length;f++){var _=o[g[f]];_&&(D=new RegExp(g[f],"g"),e=e.replace(D,_))}return e},Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear,Date.prototype.setFullYear=function(e){var t=new Date(this);t.__msh_oldSetFullYear(e),t.getMonth()!=this.getMonth()&&this.setDate(28),this.__msh_oldSetFullYear(e)},e.fn.calendar=function(a){var n=e.extend({},{triggerElement:null,parentElement:null,minYear:1900,maxYear:2100,firstDayOfWeek:1,weekend:"0,6",dateFormat:"%Y-%m-%d",dateField:null,showHandler:null,selectHandler:null,closeHandler:null},a);return this.each(function(){var a=e(this),s=new t;s.minYear=n.minYear,s.maxYear=n.maxYear,s.firstDayOfWeek=n.firstDayOfWeek,s.weekend=n.weekend,s.dateFormat=n.dateFormat,s.dateField=n.dateField||a,s.showHandler=n.showHandler||t.defaultShowHandler,s.selectHandler=n.selectHandler||t.defaultSelectHandler;var r=a.html()||a.val();if(n.parentElement)s.create(e(n.parentElement)),r&&s.parseDate(r),s.show();else{s.create(),r&&s.parseDate(r);var l=e(n.triggerElement||a);l.click(function(){s.closeHandler=n.closeHandler||t.defaultCloseHandler,s.showAtElement(l)})}}),this}}(jQuery);