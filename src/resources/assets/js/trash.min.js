jQuery.expr[':'].contains=function(a,i,m){return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0};$(function(){var checked={};var getElements=function(item,addition){var form=$('form[name="trash-form"]');var formData=new FormData(form[0]);var params={item:item};if(addition){for(var index in addition){params[index]=addition[index]}}
for(var pair of formData.entries()){params[pair[0]]=pair[1]}
$.blockUI();$.ajax({url:'/moonlight/trash/list',data:params}).done(function(response){$.unblockUI();if(response.html){$('.list-container').html(response.html)}}).fail(function(response){$.unblockUI();$.alert(response.statusText)})};var submit=function(page){$('input:hidden[name="page"]').val(page);$('form[name="trash-form"]').submit()};$('body').on('keyup change','#filter',function(){var str=$(this).val();if(str.length>0){$('ul.items > li:not(:contains("'+str+'"))').hide();$('ul.items > li:contains("'+str+'")').show()}else{$('ul.items > li').show()}});$('.search-form-links div.link').click(function(){var item=$(this).attr('item');var name=$(this).attr('name');var active=!$(this).hasClass('active');$(this).toggleClass('active');$('.search-form-params div.block[name="'+name+'"]').toggleClass('active');if(active){$('.search-form-params div.block[name="'+name+'"]').find('input, select').removeAttr('disabled')}else{$('.search-form-params div.block[name="'+name+'"]').find('input, select').attr('disabled','disabled')}
$.post('/moonlight/search/active/'+item+'/'+name,{active:active})});$('.search-form-params div.close').click(function(){var item=$(this).attr('item');var name=$(this).attr('name');$('.search-form-links div.link[name="'+name+'"]').removeClass('active');$('.search-form-params div.block[name="'+name+'"]').removeClass('active');$('.search-form-params div.block[name="'+name+'"]').find('input, select').attr('disabled','disabled');$.post('/moonlight/search/active/'+item+'/'+name,{active:!1})});$('.search-form-params div.block[name]:not(.active)').find('input, select').attr('disabled','disabled');$('.search-form-params input[name].date').calendar({dateFormat:'%Y-%m-%d'});$('.search-form-params input.one').each(function(){var parent=$(this).parents('div.row');var item=$(this).attr('item');var name=$(this).attr('property');var width=$(this).outerWidth()-2;$(this).autocomplete({serviceUrl:'/moonlight/elements/autocomplete',params:{item:item},onSelect:function(suggestion){parent.find('input:hidden[name="'+name+'"]').val(suggestion.id)},width:width,minChars:0})});$('.search-form-params .addition.unset[property]').click(function(){var parent=$(this).parents('div.row');var name=$(this).attr('property');parent.find('input:hidden[name="'+name+'"]').val('');parent.find('input:text[name="'+name+'_autocomplete"]').val('')});$('body').on('click','table.elements th span[resetorder]',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');getElements(item,{resetorder:!0})});$('body').on('click','table.elements th span[order][direction]',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');var order=$(this).attr('order');var direction=$(this).attr('direction');getElements(item,{order:order,direction:direction})});$('body').on('click','th.check',function(){var tr=$(this).parent();var table=tr.parents('table');var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');if(typeof checked[item]==='undefined'){checked[item]=[]}
if(tr.hasClass('checked')){checked[item]=[];tr.removeClass('checked');table.find('tbody tr').each(function(){$(this).removeClass('checked')})}else{tr.addClass('checked');table.find('tbody tr').each(function(){var elementId=$(this).attr('elementId');var index=checked[item].indexOf(elementId);if(index===-1){checked[item].push(elementId)}
$(this).addClass('checked')})}
if(checked[item].length){itemContainer.find('.button.restore').addClass('enabled');itemContainer.find('.button.delete').addClass('enabled')}else{itemContainer.find('.button.restore').removeClass('enabled');itemContainer.find('.button.delete').removeClass('enabled')}});$('body').on('click','td.check',function(){var tr=$(this).parent();var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');var elementId=tr.attr('elementId');if(typeof checked[item]==='undefined'){checked[item]=[]}
var index=checked[item].indexOf(elementId);if(tr.hasClass('checked')){if(index>-1){checked[item].splice(index,1)}
tr.removeClass('checked')}else{if(index===-1){checked[item].push(elementId)}
tr.addClass('checked')}
if(checked[item].length){itemContainer.find('.button.restore').addClass('enabled');itemContainer.find('.button.delete').addClass('enabled')}else{itemContainer.find('.button.restore').removeClass('enabled');itemContainer.find('.button.delete').removeClass('enabled')}});$('body').on('click','.button.restore.enabled',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');$.confirm(null,'.confirm[id="'+item+'_restore"]')});$('body').on('click','.button.delete.enabled',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');$.confirm(null,'.confirm[id="'+item+'_delete"]')});$('body').on('click','.confirm .btn.restore',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');$.confirmClose();$.blockUI();$.post('/moonlight/elements/restore',{item:item,checked:checked[item]},function(data){$.unblockUI(function(){if(data.error){$.alert(data.error)}else if(data.restored){getElements(item)}})})});$('body').on('click','.confirm .btn.remove',function(){var itemContainer=$(this).parents('div[item]');var item=itemContainer.attr('item');$.confirmClose();$.blockUI();$.post('/moonlight/elements/delete/force',{item:item,checked:checked[item]},function(data){$.unblockUI(function(){if(data.error){$.alert(data.error)}else if(data.deleted){getElements(item)}})})});$('body').on('click','ul.pager > li[prev].active',function(){var pager=$(this).parent();var item=pager.attr('item');var page=parseInt(pager.attr('page'))-1;if(page<1)page=1;submit(page)});$('body').on('click','ul.pager > li[first].active',function(){var pager=$(this).parent();var item=pager.attr('item');submit(1)});$('body').on('keydown','ul.pager > li.page > input',function(event){var pager=$(this).parents('ul.pager');var item=pager.attr('item');var page=parseInt($(this).val());var last=parseInt(pager.attr('last'));var code=event.keyCode||event.which;if(code===13){if(isNaN(page)||page<1)page=1;if(page>last)page=last;submit(page)}});$('body').on('click','ul.pager > li[last].active',function(){var pager=$(this).parent();var item=pager.attr('item');var last=pager.attr('last');submit(last)});$('body').on('click','ul.pager > li[next].active',function(){var pager=$(this).parent();var item=pager.attr('item');var page=parseInt(pager.attr('page'))+1;var last=parseInt(pager.attr('last'));if(page>last)page=last;submit(page)});$('body').on('click','li.column-toggler',function(){var li=$(this);var dropdown=li.find('.dropdown');var display=li.attr('display');if(display=='show'){li.attr('display','hide');dropdown.fadeOut(200)}else{li.attr('display','show');dropdown.fadeIn(200)}});$('body').on('click','li.column-toggler .dropdown',function(e){e.stopPropagation()});$('body').on('click','li.column-toggler .dropdown ul > li[show]',function(e){var li=$(this);var name=li.attr('name');var show=li.attr('show');var itemContainer=li.parents('div[item]');var item=itemContainer.attr('item');show=show=='true'?'false':'true';li.attr('show',show);$.post('/moonlight/column',{item:item,name:name,show:show})});$('body').on('keyup change','li.column-toggler .dropdown ul > li.perpage input',$.debounce(function(){var input=$(this);var perpage=input.val();var itemContainer=input.parents('div[item]');var item=itemContainer.attr('item');$.post('/moonlight/perpage',{item:item,perpage:perpage})},500));$('body').on('keypress','li.column-toggler .dropdown ul > li.perpage input',function(event){var input=$(this);var perpage=input.val();var itemContainer=input.parents('div[item]');var item=itemContainer.attr('item');if(!event)event=window.event;if(event.keyCode){var code=event.keyCode}else if(event.which){var code=event.which}
if(code==13){$.post('/moonlight/perpage',{item:item,perpage:perpage},function(){$('li.column-toggler .dropdown .btn').click()})}});$('body').on('click','li.column-toggler .dropdown .btn',function(e){var itemContainer=$(this).parents('div[item]');var li=$(this).parents('li.column-toggler');var dropdown=li.find('.dropdown');var item=itemContainer.attr('item');li.attr('display','hide');dropdown.fadeOut(200,function(){var url=new URL(location.href);var query_string=url.search;var search_params=new URLSearchParams(query_string);search_params.set('page','1');url.search=search_params.toString();if(window.history.replaceState){window.history.replaceState({},null,url.toString());getElements(item)}else{window.location.href=url.toString()}})})})