jQuery.expr[":"].contains=function(t,e,i){return jQuery(t).text().toUpperCase().indexOf(i[3].toUpperCase())>=0},$(function(){var t={},e=function(t){$('div[item="'+t+'"] input.one').each(function(){var t=$(this).parents("div.row"),e=$(this).attr("item"),i=$(this).attr("property"),n=$(this).outerWidth()-2;$(this).autocomplete({serviceUrl:"/moonlight/elements/autocomplete",params:{item:e},formatResult:function(t,e){return t.value+" <small>("+t.id+")</small>"},onSelect:function(e){t.find('input:hidden[name="'+i+'"]').val(e.id),t.find('span[container][name="'+i+'"]').html(e.value)},width:n,minChars:0})})},i=function(t,i){var n={item:t};if(i)for(var a in i)n[a]=i[a];$.blockUI(),$('form[name="search-form"]').ajaxSubmit({url:"/moonlight/search/list",dataType:"json",data:n,success:function(i){$.unblockUI(),i.html&&($(".list-container").html(i.html),e(t))},error:function(t){$.unblockUI(),$.alert(t.statusText)}})},n=function(t){$('input:hidden[name="page"]').val(t),$('form[name="search-form"]').submit()};$(".main div[item]").each(function(){var t=$(this).attr("item");e(t)}),$("body").on("keyup change","#filter",function(){var t=$(this).val();t.length>0?($('ul.items > li:not(:contains("'+t+'"))').hide(),$('ul.items > li:contains("'+t+'")').show()):$("ul.items > li").show()}),$("body").on("click",".sort span[sort]",function(){var t=$(this).parents(".sort").attr("activeItem"),e=$(this).attr("sort");$.blockUI(),$.post("/moonlight/search/sort",{item:t,sort:e},function(t){$.unblockUI(),t.html&&$(".items-container").html(t.html)})}),$(".search-form-links div.link").click(function(){var t=$(this).attr("item"),e=$(this).attr("name"),i=!$(this).hasClass("active");$(this).toggleClass("active"),$('.search-form-params div.block[name="'+e+'"]').toggleClass("active"),i?$('.search-form-params div.block[name="'+e+'"]').find("input, select").removeAttr("disabled"):$('.search-form-params div.block[name="'+e+'"]').find("input, select").attr("disabled","disabled"),$.post("/moonlight/search/active/"+t+"/"+e,{active:i})}),$(".search-form-params div.close").click(function(){var t=$(this).attr("item"),e=$(this).attr("name");$('.search-form-links div.link[name="'+e+'"]').removeClass("active"),$('.search-form-params div.block[name="'+e+'"]').removeClass("active"),$('.search-form-params div.block[name="'+e+'"]').find("input, select").attr("disabled","disabled"),$.post("/moonlight/search/active/"+t+"/"+e,{active:!1})}),$(".search-form-params div.block[name]:not(.active)").find("input, select").attr("disabled","disabled"),$(".search-form-params input[name].date").calendar({dateFormat:"%Y-%m-%d"}),$(".search-form-params input.one").each(function(){var t=$(this).parents("div.row"),e=$(this).attr("item"),i=$(this).attr("property"),n=$(this).outerWidth()-2;$(this).autocomplete({serviceUrl:"/moonlight/elements/autocomplete",params:{item:e},formatResult:function(t,e){return t.value+" <small>("+t.id+")</small>"},onSelect:function(e){t.find('input:hidden[name="'+i+'"]').val(e.id)},width:n,minChars:0})}),$(".search-form-params .addition.unset[property]").click(function(){var t=$(this).parents("div.row"),e=$(this).attr("property");t.find('input:hidden[name="'+e+'"]').val(""),t.find('input:text[name="'+e+'_autocomplete"]').val("")}),$("body").on("click","table.elements th span[resetorder]",function(){var t=$(this).parents("div[item]").attr("item");i(t,{resetorder:!0})}),$("body").on("click","table.elements th span[order][direction]",function(){var t=$(this).parents("div[item]").attr("item"),e=$(this).attr("order"),n=$(this).attr("direction");i(t,{order:e,direction:n})}),$("body").on("click","table.elements td.editable",function(){var t=$(this),e=t.parent(),i=$(this).parents("div[item]"),n=(i.attr("item"),t.attr("mode"));e.attr("elementId");"edit"==n?(t.attr("mode","view"),t.find(".view-container").show(),t.find(".edit-container").hide(),t.find(".edit-container").find("input,textarea").attr("disabled","disabled")):(t.attr("mode","edit"),t.find(".view-container").hide(),t.find(".edit-container").show(),t.find(".edit-container").find("input,textarea").removeAttr("disabled").focus()),i.find('td.editable[mode="edit"]').length?i.find(".button.save:not(.disabled)").addClass("enabled"):i.find(".button.save:not(.disabled)").removeClass("enabled")}),$("body").on("click","table.elements td.editable input",function(t){t.stopPropagation()}),$("body").on("click","table.elements td.editable textarea",function(t){t.stopPropagation()}),$("body").on("click","table.elements td.editable div.checkbox",function(t){var e=$(this),i=e.parents("td"),n=(i.parent(),e.attr("name"),i.find("input:hidden"));1==n.val()?($(this).removeClass("checked"),n.val(0)):($(this).addClass("checked"),n.val(1)),t.stopPropagation()}),$("body").on("submit",'form[name="save"]',function(){var t=$(this).parents("div[item]");t.attr("item");return!!t.find('td.editable[mode="edit"]').length&&($(this).ajaxSubmit({url:this.action,dataType:"json",success:function(e){if($.unblockUI(),e.error&&$.alert(e.error),e.errors)for(var i in e.errors)for(var n in e.errors[i])t.find('table.elements tr[elementId="'+i+'"] td.editable[name="'+n+'"]').addClass("invalid");if(e.views){for(var i in e.views)for(var n in e.views[i])t.find('table.elements tr[elementId="'+i+'"] td.editable[name="'+n+'"]').replaceWith(e.views[i][n]);t.find('td.editable[mode="edit"]').length||t.find(".button.save:not(.disabled)").removeClass("enabled")}},error:function(t){$.unblockUI(),$.alert(t.statusText)}}),!1)}),$("body").on("click",".button.save.enabled",function(){return $(this).parents("div[item]").find('form[name="save"]').submit(),!1}),$("body").on("click","th.check",function(){var e=$(this).parent(),i=e.parents("table"),n=$(this).parents("div[item]"),a=n.attr("item");void 0===t[a]&&(t[a]=[]),e.hasClass("checked")?(t[a]=[],e.removeClass("checked"),i.find("tbody tr").each(function(){$(this).removeClass("checked")})):(e.addClass("checked"),i.find("tbody tr").each(function(){var e=$(this).attr("elementId");-1===t[a].indexOf(e)&&t[a].push(e),$(this).addClass("checked")})),t[a].length?(n.find(".button.copy:not(.disabled)").addClass("enabled"),n.find(".button.move:not(.disabled)").addClass("enabled"),n.find(".button.bind:not(.disabled)").addClass("enabled"),n.find(".button.unbind:not(.disabled)").addClass("enabled"),n.find(".button.favorite:not(.disabled)").addClass("enabled"),n.find(".button.delete:not(.disabled)").addClass("enabled")):(n.find(".button.copy:not(.disabled)").removeClass("enabled"),n.find(".button.move:not(.disabled)").removeClass("enabled"),n.find(".button.bind:not(.disabled)").removeClass("enabled"),n.find(".button.unbind:not(.disabled)").removeClass("enabled"),n.find(".button.favorite:not(.disabled)").removeClass("enabled"),n.find(".button.delete:not(.disabled)").removeClass("enabled"))}),$("body").on("click","td.check",function(){var e=$(this).parent(),i=$(this).parents("div[item]"),n=i.attr("item"),a=e.attr("elementId");void 0===t[n]&&(t[n]=[]);var o=t[n].indexOf(a);e.hasClass("checked")?(o>-1&&t[n].splice(o,1),e.removeClass("checked")):(-1===o&&t[n].push(a),e.addClass("checked")),t[n].length?(i.find(".button.copy:not(.disabled)").addClass("enabled"),i.find(".button.move:not(.disabled)").addClass("enabled"),i.find(".button.bind:not(.disabled)").addClass("enabled"),i.find(".button.unbind:not(.disabled)").addClass("enabled"),i.find(".button.favorite:not(.disabled)").addClass("enabled"),i.find(".button.delete:not(.disabled)").addClass("enabled")):(i.find(".button.copy:not(.disabled)").removeClass("enabled"),i.find(".button.move:not(.disabled)").removeClass("enabled"),i.find(".button.bind:not(.disabled)").removeClass("enabled"),i.find(".button.unbind:not(.disabled)").removeClass("enabled"),i.find(".button.favorite:not(.disabled)").removeClass("enabled"),i.find(".button.delete:not(.disabled)").removeClass("enabled"))}),$("body").on("click",".button.copy.enabled",function(){var t=$(this).parents("div[item]").attr("item");$.confirm(null,'.confirm[id="'+t+'_copy"]')}),$("body").on("click",".button.move.enabled",function(){var t=$(this).parents("div[item]").attr("item");$.confirm(null,'.confirm[id="'+t+'_move"]')}),$("body").on("click",".button.bind.enabled",function(){var t=$(this).parents("div[item]").attr("item");$.confirm(null,'.confirm[id="'+t+'_bind"]')}),$("body").on("click",".button.unbind.enabled",function(){var t=$(this).parents("div[item]").attr("item");$.confirm(null,'.confirm[id="'+t+'_unbind"]')}),$("body").on("click",".button.favorite.enabled",function(){var e=$(this).parents("div[item]"),i=e.attr("item");e.find('div[name="add"], .favorite-list.add').hide(),e.find('div[name="remove"], .favorite-list.remove').hide(),e.find(".favorite-list.add div[rubric]").hide(),e.find(".favorite-list.remove div[rubric]").hide();for(var n in t[i]){var a=t[i][n],o=e.find('table.elements tr[elementId="'+a+'"]').attr("rubrics").split(",");e.find(".favorite-list.add div[rubric]").each(function(){var t=$(this).attr("rubric");-1===o.indexOf(t)&&($(this).show(),e.find('div[name="add"], .favorite-list.add').show())});for(var r in o){var d=o[r];e.find('.favorite-list.remove div[rubric="'+d+'"]').show(),d&&e.find('div[name="remove"], .favorite-list.remove').show()}}$.confirm(null,'.confirm[id="'+i+'_favorite"]')}),$("body").on("click",".button.delete.enabled",function(){var t=$(this).parents("div[item]").attr("item");$.confirm(null,'.confirm[id="'+t+'_delete"]')}),$("body").on("click",".confirm .btn.copy",function(){var e,i,n=$(this).parents("div[item]"),a=$(this).parents(".confirm"),o=n.attr("item");a.find('input[type="radio"]:checked:not(:disabled), input[type="hidden"]').each(function(){e=$(this).attr("property"),i=$(this).val()}),$.confirmClose(),$.blockUI(),$.post("/moonlight/elements/copy",{item:o,checked:t[o],name:e,value:i},function(t){$.unblockUI(function(){t.error?$.alert(t.error):t.copied&&t.url&&(location.href=t.url)})})}),$("body").on("click",".confirm .btn.move",function(){var e=$(this).parents("div[item]"),i=$(this).parents(".confirm"),n=e.attr("item"),a=null;if(i.find('input[type="radio"]:checked:not(:disabled), input[type="hidden"]').each(function(){var t=$(this).attr("property"),e=$(this).val();a={name:t,value:e}}),!a)return!1;$.confirmClose(),$.blockUI(),$.post("/moonlight/elements/move",{item:n,checked:t[n],name:a.name,value:a.value},function(t){$.unblockUI(function(){t.error?$.alert(t.error):t.moved&&t.url&&(location.href=t.url)})})}),$("body").on("click",".confirm .btn.bind",function(){var e=$(this).parents("div[item]"),n=$(this).parents(".confirm"),a=e.attr("item"),o={},r=0;if(n.find('input[type="radio"]:checked:not(:disabled), input[type="hidden"]').each(function(){var t=$(this).attr("property"),e=$(this).val();e&&(o[t]=e,r++)}),!r)return!1;$.confirmClose(),$.blockUI(),$.post("/moonlight/elements/bind",{item:a,checked:t[a],ones:o},function(t){t.error?$.unblockUI(function(){$.alert(t.error)}):t.attached&&i(a)})}),$("body").on("click",".confirm .btn.unbind",function(){var e=$(this).parents("div[item]"),n=$(this).parents(".confirm"),a=e.attr("item"),o={},r=0;if(n.find('input[type="radio"]:checked:not(:disabled), input[type="hidden"]').each(function(){var t=$(this).attr("property"),e=$(this).val();e&&(o[t]=e,r++)}),!r)return!1;$.confirmClose(),$.blockUI(),$.post("/moonlight/elements/unbind",{item:a,checked:t[a],ones:o},function(t){t.error?$.unblockUI(function(){$.alert(t.error)}):t.detached&&i(a)})}),$("body").on("click",".confirm .favorite-list.add div[rubric]",function(){var e=$(this).parents(".confirm"),n=$(this).parents("div[item]").attr("item"),a=e.attr("url"),o=$(this).attr("rubric");return!!a&&(!!o&&($.confirmClose(),$.blockUI(),void $.post(a,{item:n,checked:t[n],add_favorite_rubric:o},function(t){$.unblockUI(function(){t.error?$.alert(t.error):t.saved&&i(n)})}).fail(function(){$.unblockUI(),$.alertDefaultError()})))}),$("body").on("click",".confirm .favorite-list.remove div[rubric]",function(){var e=$(this).parents(".confirm"),n=$(this).parents("div[item]").attr("item"),a=e.attr("url"),o=$(this).attr("rubric");return!!a&&(!!o&&($.confirmClose(),$.blockUI(),void $.post(a,{item:n,checked:t[n],remove_favorite_rubric:o},function(t){$.unblockUI(function(){t.error?$.alert(t.error):t.saved&&i(n)})}).fail(function(){$.unblockUI(),$.alertDefaultError()})))}),$("body").on("keypress",'.confirm .favorite-new input[type="text"]',function(t){if(t||(t=window.event),t.keyCode)var e=t.keyCode;else if(t.which)e=t.which;13==e&&$(this).parents(".confirm").find(".btn.favorite").click()}),$("body").on("click",".confirm .btn.favorite",function(){var e=$(this).parents(".confirm"),n=$(this).parents("div[item]").attr("item"),a=e.attr("url"),o=e.find('.favorite-new input[type="text"]').val();return!!a&&(!!o&&($.confirmClose(),$.blockUI(),void $.post(a,{item:n,checked:t[n],new_favorite_rubric:o},function(t){$.unblockUI(function(){t.error?$.alert(t.error):t.saved&&i(n)})}).fail(function(){$.unblockUI(),$.alertDefaultError()})))}),$("body").on("click",".confirm .btn.remove",function(){var e=$(this).parents("div[item]").attr("item");$.confirmClose(),$.blockUI(),$.post("/moonlight/elements/delete",{item:e,checked:t[e]},function(t){$.unblockUI(),t.error?$.unblockUI(function(){$.alert(t.error)}):t.deleted&&i(e)})}),$("body").on("click","ul.pager > li[prev].active",function(){var t=$(this).parent(),e=(t.attr("item"),parseInt(t.attr("page"))-1);e<1&&(e=1),n(e)}),$("body").on("click","ul.pager > li[first].active",function(){$(this).parent().attr("item");n(1)}),$("body").on("keydown","ul.pager > li.page > input",function(t){var e=$(this).parents("ul.pager"),i=(e.attr("item"),parseInt($(this).val())),a=parseInt(e.attr("last"));13===(t.keyCode||t.which)&&(i<1&&(i=1),i>a&&(i=a),n(i))}),$("body").on("click","ul.pager > li[last].active",function(){var t=$(this).parent(),e=(t.attr("item"),t.attr("last"));n(e)}),$("body").on("click","ul.pager > li[next].active",function(){var t=$(this).parent(),e=(t.attr("item"),parseInt(t.attr("page"))+1),i=parseInt(t.attr("last"));e>i&&(e=i),n(e)}),$("body").on("click","li.column-toggler",function(){var t=$(this),e=t.find(".dropdown");"show"==t.attr("display")?(t.attr("display","hide"),e.fadeOut(200)):(t.attr("display","show"),e.fadeIn(200))}),$("body").on("click","li.column-toggler .dropdown",function(t){t.stopPropagation()}),$("body").on("click","li.column-toggler .dropdown ul > li[show]",function(t){var e=$(this),i=e.attr("name"),n=e.attr("show"),a=e.parents("div[item]").attr("item");n="true"==n?"false":"true",e.attr("show",n),$.post("/moonlight/column",{item:a,name:i,show:n})}),$("body").on("click","li.column-toggler .dropdown .btn",function(t){var e=$(this).parents("div[item]"),n=$(this).parents("li.column-toggler"),a=n.find(".dropdown"),o=e.attr("item");n.attr("display","hide"),a.fadeOut(200,function(){i(o)})})});